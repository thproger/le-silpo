<div class="manual-wrapper p-4">
  <div class="bg-white rounded shadow-sm">
    <table class="table table-bordered mb-0">
      <thead class="table-dark text-center">
        <tr>
          <th>ID</th>
          <th>longitude</th>
          <th>latitude</th>
          <th>timestamp</th>
          <th>subtotal</th>
        </tr>
      </thead>
      <tbody [formGroup]="orderForm">
        <ng-container formArrayName="rows">
          @for (row of rows.controls; track i; let i = $index) {
            <tr [formGroupName]="i">
              <td class="text-center align-middle bg-light fw-bold" style="width: 50px">
                {{ i + 1 }}
              </td>
              <td class="position-relative">
                <input formControlName="longitude" class="form-control border-0 text-center" />
                <button
                  (click)="openMap(i)"
                  class="btn btn-sm btn-link position-absolute end-0 top-50 translate-middle-y"
                >
                  <i class="bi bi-geo-alt-fill text-primary"></i>
                </button>
              </td>
              <td>
                <input formControlName="latitude" class="form-control border-0 text-center" />
              </td>
              <td>
                <input formControlName="timestamp" class="form-control border-0 text-center" />
              </td>
              <td>
                <input formControlName="subtotal" class="form-control border-0 text-center" />
              </td>
            </tr>
          }

          @if (isMapVisible) {
            <div class="map-modal-overlay" (click)="closeMap()">
              <div class="map-modal-content shadow-lg" (click)="$event.stopPropagation()">
                <div class="map-modal-header">
                  <h5 class="m-0">Select location in NYC</h5>
                  <button type="button" class="btn-close" (click)="closeMap()">Ã—</button>
                </div>
                <div id="map-container"></div>
                <div class="p-2 text-center small text-muted">
                  Click on the map to select coordinates
                </div>
              </div>
            </div>
          }
        </ng-container>
        <tr class="bg-light cursor-pointer text-center" (click)="addRow()">
          <td colspan="7" class="py-2 text-muted"><i class="bi bi-plus-lg"></i></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
