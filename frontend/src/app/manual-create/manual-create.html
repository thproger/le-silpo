<div class="manual-wrapper p-4">
  <div class="bg-white rounded shadow-sm border overflow-hidden">
    <table class="table table-hover mb-0">
      <thead class="table-dark text-center">
        <tr>
          <th style="width: 50px">#</th>
          <th>Location (Lat, Lng)</th>
          <th>Timestamp</th>
          <th>Subtotal</th>
          <th style="width: 80px">Action</th>
        </tr>
      </thead>
      <tbody [formGroup]="orderForm">
        <ng-container formArrayName="rows">
          @for (row of rows.controls; track i; let i = $index) {
            <tr [formGroupName]="i" class="align-middle">
              <td class="text-center bg-light fw-bold">{{ i + 1 }}</td>

              <td class="position-relative p-0">
                <div class="d-flex align-items-center px-2">
                  <input
                    [value]="
                      row.value.latitude && row.value.longitude
                        ? row.value.latitude + ', ' + row.value.longitude
                        : ''
                    "
                    class="form-control border-0 text-center bg-transparent"
                    placeholder="Click map to pick..."
                    readonly
                  />
                  <button (click)="openMap(i)" class="btn btn-sm btn-outline-primary ms-2">
                    <i class="bi bi-geo-alt-fill"></i>
                  </button>
                </div>
              </td>

              <td>
                <input
                  formControlName="timestamp"
                  class="form-control border-0 text-center"
                  placeholder="2025-11-04 10:17:05"
                />
              </td>
              <td>
                <input
                  formControlName="subtotal"
                  type="number"
                  class="form-control border-0 text-center"
                  placeholder="0.00"
                />
              </td>

              <td class="text-center">
                <button (click)="submitRow(i)" class="btn btn-success btn-sm" [disabled]="rows.at(i).invalid">
                  <i class="bi bi-cloud-arrow-up"></i>
                </button>
              </td>
            </tr>
          }

          @if (isMapVisible) {
            <div class="map-modal-overlay" (click)="closeMap()">
              <div class="map-modal-content shadow-lg" (click)="$event.stopPropagation()">
                <div class="map-modal-header">
                  <h5 class="m-0">Select location in NYC</h5>
                  <button type="button" class="btn-close" (click)="closeMap()">Ã—</button>
                </div>
                <div id="map-container"></div>
                <div class="p-2 text-center small text-muted">
                  Click on the map to select coordinates
                </div>
              </div>
            </div>
          }
        </ng-container>

        <tr class="bg-light cursor-pointer text-center" (click)="addRow()">
          <td colspan="5" class="py-3 text-primary fw-bold">
            <i class="bi bi-plus-circle-fill"></i> Add New Row
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
